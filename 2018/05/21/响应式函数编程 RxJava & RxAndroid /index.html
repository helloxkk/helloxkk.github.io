
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>响应式函数编程 RxJava &amp; RxAndroid | 肖坤的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Github: https://github.com/ReactiveX/RxJava 中文资料:  https://github.com/lzyzsd/Awesome-RxJava https://www.zhihu.com/question/35511144   用途: 异步操作 在程序逻辑异常复杂的情况下,仍然可以让代码的逻辑保持简洁   配置: 添加依赖:  compile &amp;apos;">
<meta property="og:type" content="article">
<meta property="og:title" content="响应式函数编程 RxJava &amp; RxAndroid">
<meta property="og:url" content="http://hellokk.cc/2018/05/21/响应式函数编程 RxJava & RxAndroid /index.html">
<meta property="og:site_name" content="肖坤的博客">
<meta property="og:description" content="Github: https://github.com/ReactiveX/RxJava 中文资料:  https://github.com/lzyzsd/Awesome-RxJava https://www.zhihu.com/question/35511144   用途: 异步操作 在程序逻辑异常复杂的情况下,仍然可以让代码的逻辑保持简洁   配置: 添加依赖:  compile &amp;apos;">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-05-21T12:38:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="响应式函数编程 RxJava &amp; RxAndroid">
<meta name="twitter:description" content="Github: https://github.com/ReactiveX/RxJava 中文资料:  https://github.com/lzyzsd/Awesome-RxJava https://www.zhihu.com/question/35511144   用途: 异步操作 在程序逻辑异常复杂的情况下,仍然可以让代码的逻辑保持简洁   配置: 添加依赖:  compile &amp;apos;">
  
    <link rel="alternative" href="/atom.xml" title="肖坤的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
</head>
<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">肖坤的博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" class="search-form">
          <input type="search" name="word" maxlength="20" class="search-form-input" placeholder="Search">
          <input type="submit" value="" class="search-form-submit">
          <input name=tn type=hidden value="bds">
          <input name=cl type=hidden value="3">
          <input name=ct type=hidden value="2097152">
          <input type="hidden" name="si" value="hellokk.cc">
        </form>
      </div>
    </div>
  </div>
</header>
    <div class="outer">
      <section id="main"><article id="post-响应式函数编程 RxJava &amp; RxAndroid " class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/05/21/响应式函数编程 RxJava & RxAndroid /" class="article-date">
  <time datetime="2018-05-21T12:38:54.000Z" itemprop="datePublished">2018-05-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      响应式函数编程 RxJava &amp; RxAndroid
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>Github: <a href="https://github.com/ReactiveX/RxJava" target="_blank" rel="external">https://github.com/ReactiveX/RxJava</a></li>
<li>中文资料: <ul>
<li><a href="https://github.com/lzyzsd/Awesome-RxJava" target="_blank" rel="external">https://github.com/lzyzsd/Awesome-RxJava</a></li>
<li><a href="https://www.zhihu.com/question/35511144" target="_blank" rel="external">https://www.zhihu.com/question/35511144</a></li>
</ul>
</li>
<li>用途:<ul>
<li>异步操作</li>
<li>在程序逻辑异常复杂的情况下,仍然可以让代码的逻辑保持简洁</li>
</ul>
</li>
<li><p>配置: 添加依赖: </p>
<pre><code>compile &apos;io.reactivex:rxjava:1.1.3&apos;
compile &apos;io.reactivex:rxandroid:1.1.0&apos;

//如果结合Retrofit使用,需要添加以下依赖

compile &apos;com.squareup.retrofit2:retrofit:2.0.1&apos;
compile &apos;com.squareup.retrofit2:converter-gson:2.0.1&apos;
compile &apos;com.squareup.retrofit2:adapter-rxjava:2.0.1&apos;
</code></pre></li>
</ul>
<ul>
<li>基本概念:</li>
</ul>
<h2 id="1-被观察者-Observable"><a href="#1-被观察者-Observable" class="headerlink" title="1. 被观察者: Observable"></a>1. 被观察者: Observable</h2><ul>
<li>作用: 决定什么时候触发事件以及触发怎样的事件</li>
<li>创建方法:<ul>
<li>Observable.just(T…) 参数为单个的</li>
<li>Observable.from(T[]) / Observable.from(Iterable&lt;? extends T&gt;)  参数为数组或Iterable</li>
</ul>
</li>
</ul>
<h2 id="2-观察者-Observer"><a href="#2-观察者-Observer" class="headerlink" title="2. 观察者: Observer"></a>2. 观察者: Observer</h2><ul>
<li>作用: 当事件触发的时候将有怎样的行为</li>
<li>实现类有Observer / Subscriber </li>
</ul>
<h2 id="3-订阅-subscribe"><a href="#3-订阅-subscribe" class="headerlink" title="3. 订阅: subscribe"></a>3. 订阅: subscribe</h2><ul>
<li>作用: 把Observable和Observer关联起来</li>
<li>方法:<ul>
<li>observable.subscribe(observer);</li>
<li>observable.subscribe(subscriber);<h2 id="4-事件"><a href="#4-事件" class="headerlink" title="4. 事件:"></a>4. 事件:</h2></li>
</ul>
</li>
<li>onNext()：普通事件</li>
<li>onCompleted():事件队列完结</li>
<li>onError(): 事件队列异常</li>
<li>需要注意的是onCompleted()和onError()是互斥的.调用了其中一个就不应该触发另一个.<h2 id="5-案例"><a href="#5-案例" class="headerlink" title="5. 案例:"></a>5. 案例:</h2></li>
<li><p>现有一个数组 String[] arr ={“afdsa”, “bfdsa”, “cfda”}, 把其中以字母”a”开头的字符串找出来并加上”from Alpha”,最后打印出新的字符串的长度</p>
<pre><code>private void simpleDemo() {

     String[] arr = {&quot;afdsa&quot;, &quot;bfdsa&quot;, &quot;cfda&quot;};

     Observable
             .from(arr)
             .filter(new Func1&lt;String, Boolean&gt;() {
                 @Override
                 public Boolean call(String s) {
                     return s.startsWith(&quot;a&quot;);
                 }
             })
             .map(new Func1&lt;String, String&gt;() {
                 @Override
                 public String call(String s) {
                     return s + &quot; from Alpha&quot;;
                 }
             })
             .subscribe(new Action1&lt;String&gt;() {
                 @Override
                 public void call(String s) {
                     System.out.println(&quot;Rxjava:&quot; + s.length());
                 }
             });

     for (int i = 0; i &lt; arr.length; i++) {
         String temp = arr[i];
         if (temp.startsWith(&quot;a&quot;)) {
             temp += &quot; from Alpha&quot;;
             System.out.println(&quot;Normal:&quot; + temp.length());
         }

     }
</code></pre></li>
</ul>
<ul>
<li><p>由指定的一个 drawable 文件 id 取得图片，并显示在 ImageView 中，并在出现异常的时候打印 Toast 报错：</p>
<pre><code>private void simpleDemo() {

    final int drawID = R.mipmap.ic_launcher;
    Observable
            .create(new Observable.OnSubscribe&lt;Drawable&gt;() {
                @Override
                public void call(Subscriber&lt;? super Drawable&gt; subscriber) {
                    Drawable drawable = getResources().getDrawable(drawID);
                    subscriber.onNext(drawable);
                    subscriber.onCompleted();
                }
            })
            .subscribe(new Observer&lt;Drawable&gt;() {
                @Override
                public void onCompleted() {

                }

                @Override
                public void onError(Throwable e) {
                    Toast.makeText(MainActivity.this, &quot;Error&quot;, Toast.LENGTH_SHORT).show();
                }

                @Override
                public void onNext(Drawable drawable) {
                    imageView.setImageDrawable(drawable);
                }
            });
}
</code></pre></li>
</ul>
<h2 id="6-Scheduler"><a href="#6-Scheduler" class="headerlink" title="6. Scheduler"></a>6. Scheduler</h2><ul>
<li>作用: 控制线程.指定某一段代码在那个线程里运行.</li>
<li><p>内置的Scheduler:</p>
<ul>
<li>Schedulers.immediate(): 直接在当前线程运行，相当于不指定线程。这是默认的 Scheduler。</li>
<li>Schedulers.newThread(): 总是启用新线程，并在新线程执行操作。</li>
<li>Schedulers.io(): I/O 操作（读写文件、读写数据库、网络信息交互等）所使用的 Scheduler。行为模式和 newThread() 差不多，区别在于 io() 的内部实现是是用一个无数量上限的线程池，可以重用空闲的线程，因此多数情况下 io() 比 newThread() 更有效率。不要把计算工作放在 io() 中，可以避免创建不必要的线程。</li>
<li>Schedulers.computation(): 计算所使用的 Scheduler。这个计算指的是 CPU 密集型计算，即不会被 I/O 等操作限制性能的操作，例如图形的计算。这个 Scheduler 使用的固定的线程池，大小为 CPU 核数。不要把 I/O 操作放在 computation() 中，否则 I/O 操作的等待时间会浪费 CPU。</li>
<li>AndroidSchedulers.mainThread(): Android专用,它指定的操作将在 Android 主线程运行。</li>
</ul>
</li>
<li><p>指定线程的方法:</p>
<ul>
<li>Observable.subscribeOn():指定 subscribe() 所发生的线程，即 Observable.OnSubscribe 被激活时所处的线程。或者叫做事件产生的线程</li>
<li>Observable.observeOn():指定 Subscriber 所运行在的线程。或者叫做事件消费的线程。</li>
</ul>
</li>
</ul>
<h2 id="7-数据变换"><a href="#7-数据变换" class="headerlink" title="7. 数据变换:"></a>7. 数据变换:</h2><ul>
<li>作用: 就是将事件序列中的对象或整个序列进行加工处理，转换成不同的事件或事件序列</li>
<li><p>Observable.map:  一对一的转换</p>
<pre><code>private void simpleDemo() {
     Observable
             .just(R.mipmap.ic_launcher)
             .map(new Func1&lt;Integer, Drawable&gt;() {
                 @Override
                 public Drawable call(Integer integer) {
                     return getResources().getDrawable(integer);
                 }
             })
             .subscribe(new Action1&lt;Drawable&gt;() {
                 @Override
                 public void call(Drawable drawable) {
                     imageView.setImageDrawable(drawable);
                 }
             });
 }
</code></pre></li>
<li><p>Observable.flatMap: 一对多的转换</p>
<pre><code>public class Course {
 private String name;
 private int id;

 public Course(String name, int id) {
     this.name = name;
     this.id = id;
 }

 public String getName() {
     return name;
 }

 public void setName(String name) {
     this.name = name;
 }

 public int getId() {
     return id;
 }

 public void setId(int id) {
     this.id = id;
 }
}

public class Student {
 private String name;

 private ArrayList&lt;Course&gt; courses;

 public Student(String name, ArrayList&lt;Course&gt; courses) {
     this.name = name;
     this.courses = courses;
 }

 public String getName() {
     return name;
 }

 public void setName(String name) {
     this.name = name;
 }

 public ArrayList&lt;Course&gt; getCourses() {
     return courses;
 }

 public void setCourses(ArrayList&lt;Course&gt; courses) {
     this.courses = courses;
 }
}

private void student() {

    Course yuwen = new Course(&quot;语文&quot;, 1);
    Course shuxue = new Course(&quot;数学&quot;, 2);
    Course yingyu = new Course(&quot;英文&quot;, 3);
    Course lishi = new Course(&quot;历史&quot;, 4);
    Course zhengzhi = new Course(&quot;政治&quot;, 5);
    Course xila = new Course(&quot;希腊语&quot;, 6);

    ArrayList&lt;Course&gt; course1 = new ArrayList&lt;&gt;();
    course1.add(yuwen);
    course1.add(shuxue);
    course1.add(yingyu);
             course1.add(lishi);
             course1.add(zhengzhi);
             course1.add(xila);
    Student zhangsan = new Student(&quot;zhangsan&quot;, course1);

    Observable.just(zhangsan)
            .flatMap(new Func1&lt;Student, Observable&lt;Course&gt;&gt;() {
                @Override
                public Observable&lt;Course&gt; call(Student student) {
                    return Observable.from(student.getCourses());
                }
            }).subscribe(new Action1&lt;Course&gt;() {
        @Override
        public void call(Course course) {
            System.out.println(course.getName());
        }
    });
}
</code></pre></li>
</ul>
<h2 id="8-和Retrofit一起使用"><a href="#8-和Retrofit一起使用" class="headerlink" title="8. 和Retrofit一起使用"></a>8. 和Retrofit一起使用</h2><ol>
<li><p>添加依赖: </p>
<pre><code>compile &apos;com.squareup.retrofit2:retrofit:2.0.1&apos;
compile &apos;com.squareup.retrofit2:converter-gson:2.0.1&apos;
compile &apos;com.squareup.retrofit2:adapter-rxjava:2.0.1&apos;
</code></pre></li>
</ol>
<ol>
<li><p>利用<a href="http://www.jsonschema2pojo.org/" target="_blank" rel="external">http://www.jsonschema2pojo.org/</a>创建数据模型</p>
</li>
<li><p>创建REST API 接口.注意此时返回的不能是Call而是Observable.示例代码:</p>
<pre><code>public interface LocationInterface {
    // http://ip.taobao.com/service/getIpInfo.php?ip=202.178.10.23
    @GET(&quot;/service/getIpInfo.php&quot;)
    public Observable&lt;Location&gt; getLocation(@Query(&quot;ip&quot;) String ip);

}
</code></pre></li>
</ol>
<ol>
<li><p>创建Retrofit对象,发起请求.注意此时Retrofit需要添加addCallAdapterFactory.示例代码:</p>
<pre><code>Retrofit retrofit = new Retrofit.Builder()
         .baseUrl(BASE2)
         .addConverterFactory(GsonConverterFactory.create())
         .addCallAdapterFactory(RxJavaCallAdapterFactory.create())
         .build();

 LocationInterface locationInterface = retrofit.create(LocationInterface.class);
 Observable&lt;Location&gt; location = locationInterface.getLocation(&quot;8.8.8.8&quot;);
 location
         .subscribeOn(Schedulers.io())
         .map(new Func1&lt;Location, String&gt;() {

             @Override
             public String call(Location location) {
                 return location.getData().getCountry();
             }
         })
         .observeOn(AndroidSchedulers.mainThread())
         .subscribe(new Action1&lt;String&gt;() {
             @Override
             public void call(String s) {
                 textView.setText(s);
             }
    });
</code></pre></li>
</ol>

      
    </div>
    <footer class="article-footer">
      
        <a data-url="http://hellokk.cc/2018/05/21/响应式函数编程 RxJava & RxAndroid /" data-id="cjtcfau4900068t0phd2n6gi9" class="article-share-link" data-share="baidu" data-title="响应式函数编程 RxJava &amp; RxAndroid">分享到</a>
      

      
        <a href="http://hellokk.cc/2018/05/21/响应式函数编程 RxJava & RxAndroid /#ds-thread" class="article-comment-link">评论</a>
      

      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/06/05/Kotlin 中使用 Anko 编写布局/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <div class="article-nav-title">
        
          Kotlin 中使用 Anko 编写布局
        
      </div>
    </a>
  
  
    <a href="/2017/11/19/仿QQ空间打赏功能实现/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <div class="article-nav-title">仿QQ空间打赏功能实现</div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <div id="ds-thread" class="ds-thread" data-thread-key="2018/05/21/响应式函数编程 RxJava &amp; RxAndroid /" data-title="响应式函数编程 RxJava &amp; RxAndroid" data-url="http://hellokk.cc/2018/05/21/响应式函数编程 RxJava &amp; RxAndroid /"></div>
  </section>
</section>
      
      <aside id="sidebar">
  
    
  
    
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">近期文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/07/25/仿微信剪切视频时长View/">仿微信剪切视频时长View</a>
          </li>
        
          <li>
            <a href="/2018/06/05/使用观察者模式进行订单管理/">使用观察者模式进行订单管理</a>
          </li>
        
          <li>
            <a href="/2018/06/05/Kotlin 中使用 Anko 编写布局/">Kotlin 中使用 Anko 编写布局</a>
          </li>
        
          <li>
            <a href="/2018/05/21/响应式函数编程 RxJava & RxAndroid /">响应式函数编程 RxJava &amp; RxAndroid</a>
          </li>
        
          <li>
            <a href="/2017/11/19/仿QQ空间打赏功能实现/">仿QQ空间打赏功能实现</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">友情链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://arvinxiang.com" target="_blank">主题作者</a>
          </li>
        
          <li>
            <a href="http://reqianduan.com" target="_blank">热前端</a>
          </li>
        
          <li>
            <a href="http://yuancheng.work" target="_blank">远程.work</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 青宁<br>
      Powered by <a href="//hexo.io/" target="_blank">Hexo</a>
      .
      Theme by <a href="https://github.com/xiangming/landscape-plus" target="_blank">Landscape-plus</a>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
  <!-- totop start -->
<div id="totop">
<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>

<!-- totop end -->

<!-- 多说公共js代码 start -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"reqianduan"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共js代码 end -->


<!-- 百度分享 start -->

<div id="article-share-box" class="article-share-box">
  <div id="bdshare" class="bdsharebuttonbox article-share-links">
    <a class="article-share-weibo" data-cmd="tsina" title="分享到新浪微博"></a>
    <a class="article-share-weixin" data-cmd="weixin" title="分享到微信"></a>
    <a class="article-share-qq" data-cmd="sqq" title="分享到QQ"></a>
    <a class="article-share-renren" data-cmd="renren" title="分享到人人网"></a>
    <a class="article-share-more" data-cmd="more" title="更多"></a>
  </div>
</div>
<script>
  function SetShareData(cmd, config) {
    if (shareDataTitle && shareDataUrl) {
      config.bdText = shareDataTitle;
      config.bdUrl = shareDataUrl;
    }
    return config;
  }
  window._bd_share_config={
    "common":{onBeforeClick: SetShareData},
    "share":{"bdCustomStyle":"/css/bdshare.css"}
  };
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

<!-- 百度分享 end -->

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>




<script src="/js/script.js"></script>

</div>
</body>
</html>
